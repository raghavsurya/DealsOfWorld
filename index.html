<!DOCTYPE html>
<html>

<head>
    <title>Deals of World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="../node_modules/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="../app/app.component.css" rel="stylesheet" />
    <link href="../app/mobile.css" rel="stylesheet" />
     <link href="../app/reset.css" rel="stylesheet" />
      <link href="../app/style.css" rel="stylesheet" />
        <link href="../app/menu-vertical.css" rel="stylesheet" />
   

    <!-- 1. Load libraries -->
    <!-- IE required polyfills, in this exact order -->
    <script src="../node_modules/angular2/es6/dev/src/testing/shims_for_IE.js"></script>
    <script src="../node_modules/es6-shim/es6-shim.min.js"></script>
    <script src="../node_modules/systemjs/dist/system-polyfills.js"></script>

    <script src="../node_modules/angular2/bundles/angular2-polyfills.js"></script>
    <script src="../node_modules/systemjs/dist/system.src.js"></script>
    <script src="../node_modules/rxjs/bundles/Rx.js"></script>
    <script src="../node_modules/angular2/bundles/angular2.dev.js"></script>
      <script src="../node_modules/jquery/dist/jquery-2.1.4.js"></script>
     <script src="../node_modules/bootstrap/dist/js/bootstrap.js"></script>
      <script src="../node_modules/angular2/bundles/http.dev.js"></script>
     
      <script src="../app/scripts/raf.js"></script>
      <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Intl.~locale.en"></script>
     

      
    <script>
        System.config({
            packages: {
                app : {
                    format: "register",
                    defaultExtension: "js"
                }
                },
            map: {
                lodash: 'node_modules/lodash/lodash.js'
                }
        });
        System.import('app/main')
        .then(null, console.error.bind(console));
    //         .then((module)=> {
    // module.main(rootVar);
    //       });
    </script>
    </head>

<body>
   
<script type="text/javascript">


function geolocate(timezone, cityPrecision, objectVar) {
 
  var api = (cityPrecision) ? "ip-city" : "ip-country";
  var domain = 'api.ipinfodb.com';
  var url = "http://" + domain + "/v3/" + api + "/?key=aef3ded3b16d25b42920b819405f6bcbf2bd22ab6b9241d1257436a7b59a6878&format=json" + "&callback=" + objectVar + ".setGeoCookie";
  var geodata;
  var callbackFunc;
  var JSON = JSON || {};
 
  // implement JSON.stringify serialization
  JSON.stringify = JSON.stringify || function (obj) {
    var t = typeof (obj);
    if (t != "object" || obj === null) {
      // simple data type
      if (t == "string") obj = '"'+obj+'"';
        return String(obj);
    } else {
    // recurse array or object
      var n, v, json = [], arr = (obj && obj.constructor == Array);
      for (n in obj) {
        v = obj[n]; t = typeof(v);
        if (t == "string") v = '"'+v+'"';
        else if (t == "object" && v !== null) v = JSON.stringify(v);
        json.push((arr ? "" : '"' + n + '":') + String(v));
      }
      return (arr ? "[" : "{") + String(json) + (arr ? "]" : "}");
    }
  };
 
  // implement JSON.parse de-serialization
  JSON.parse = JSON.parse || function (str) {
    if (str === "") str = '""';
      eval("var p=" + str + ";");
      return p;
  };
 
  //Check if cookie already exist. If not, query IPInfoDB
  this.checkcookie = function(callback) {
    geolocationCookie = getCookie('geolocation');
    console.log(geolocationCookie);
    callbackFunc = callback;
    if (!geolocationCookie) {
      getGeolocation();
    } else {
      geodata = JSON.parse(geolocationCookie);
      callbackFunc();
    }
  }
 
  //API callback function that sets the cookie with the serialized JSON answer
  this.setGeoCookie = function(answer) {
    if (answer['statusCode'] == 'OK') {
      JSONString = JSON.stringify(answer);
    //  console.log(JSONString);
      setCookie('geolocation', JSONString, 365);
      geodata = answer;
      callbackFunc();
    }
  }
 
  //Return a geolocation field
  this.getField = function(field) {
    try {
      return geodata[field];
    } catch(err) {}
  }
 
  //Request to IPInfoDB
  function getGeolocation() {
    try {
      script = document.createElement('script');
      script.src = url;
      document.body.appendChild(script);
    } catch(err) {}
  }
 
  //Set the cookie
  function setCookie(c_name, value, expire) {
    var exdate=new Date();
    exdate.setDate(exdate.getDate()+expire);
    document.cookie = c_name+ "=" +escape(value) + ((expire==null) ? "" : ";expires="+exdate.toGMTString());
  }
 
  //Get the cookie content
  function getCookie(c_name) {
    if (document.cookie.length > 0 ) {
      c_start=document.cookie.indexOf(c_name + "=");
      if (c_start != -1){
        c_start=c_start + c_name.length+1;
        c_end=document.cookie.indexOf(";",c_start);
        if (c_end == -1) {
          c_end=document.cookie.length;
        }
        return unescape(document.cookie.substring(c_start,c_end));
      }
    }
    return '';
  }
}
 var rootVar;
</script>


<script type="text/javascript">

var visitorGeolocation = new geolocate(false, true, 'visitorGeolocation');
 
//Check for cookie and run a callback function to execute after geolocation is read either from cookie or IPInfoDB API
var callback = function(){
                ('Visitor country code : ' + visitorGeolocation.getField('countryCode'))
               };
visitorGeolocation.checkcookie(callback);
if(!sessionStorage["countryCode"]){
rootVar = visitorGeolocation.getField('countryCode');
if(!rootVar)
{
   rootVar = "us";
   sessionStorage["countryCode"] = rootVar;//visitorGeolocation.getField('countryCode');
}
if(rootVar == "GB") rootVar = "uk";
    rootVar= rootVar.toLowerCase();
}
else{
    rootVar = sessionStorage["countryCode"];
    rootVar= rootVar.toLowerCase();
} 


console.log(rootVar);
if(rootVar == "gb") rootVar = "uk";


</script>


  
  <dw-app>
    <!--<div id="overlay"><img style="margin:15% 0 0 40%" src="app/Assets/Images/output_UFLiPX.gif" /></div>
    -->
    <div class="modal"></div>
  </dw-app>
 

</body>

</html>